building_dic = {
	'Office of Admissions':{
		'location':'2 College Avenue West, University Town #01-03 (S) 138607',
		'area':'University Town',
		'tel':'+65 6516 1010',
		'fax':'+65 6778 7570',
		'stop': [['UNIVERSITY TOWN']]
	},
	'Office of Alumni Relations':{
		'location':'11 Kent Ridge Drive, Shaw Foundation Alumni House (S) 119244',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 5775',
		'fax':'+65 6464 1498',
		'stop': [['NUSS']]
	},
	'Office of Campus Amenities':{
		'location':'8 Kent Ridge Drive, #02-01 (S) 119246',
		'area':'Ventus (University Campus Infrastructure)',
		'tel':'',
		'fax':'',
		'stop': [['LT 13', 'VENTUS', 'KR BUS TERMINAL']]
	},
	'Office of Financial Services':{
		'location':'21 Lower Kent Ridge Road, University Hall, Tan Chin Tuan Wing #03-02 (S) 119077',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 1981',
		'fax':'+65 6778 6570',
		'stop': [['YIH', 'OPP YIH'], ['UHC', 'OPP UHC']]
	},
	'Office of Human Resources':{
		'location':'University Hall Tan Chin Tuan Wing, #04-01, 21 Lower Kent Ridge Road (S) 119077',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 2331',
		'fax':'+65 6778 3948',
		'stop': [['UNIVERSITY HALL', 'OPP UNIVERSITY HALL'], ['UHC', 'OPP UHC']]
	},
	'Office of Housing Services':{
		'location':'10 Kent Ridge Crescent, Block ADM Level 3 (S) 119260',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 3697',
		'fax':'+65 6777 3840',
		'stop': [['CENTRAL LIBRARY', 'IT']]
	},
	'Information Technology':{
		'location':'2 Engineering Drive 4 (S) 117584',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 2080',
		'fax':'+65 6516 7210',
		'stop': [['CENTRAL LIBRARY', 'IT']]
	},
	'NUS Entrepreneurship Centre':{
		'location':'21 Heng Mui Keng Terrace, I3 Building Level 5 (S) 119613',
		'area':'Kent Ridge Campus',
		'tel':'+65 6777 6990',
		'fax':'',
		'stop': [['BIZ 2']]
	},
	'C J Koh Law Library':{
		'location':'469D Bukit Timah Road (S) 259773',
		'area':'Bukit Timah Campus',
		'tel':'+65 6516 2043',
		'fax':'+65 6468 3407',
		'stop': [['COLLEGE GREEN']]
	},
	'Central Library':{
		'location':'12 Kent Ridge Crescent (S) 119275',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 2028',
		'fax':'+65 6777 3571',
		'stop': [['CENTRAL LIBRARY', 'IT']]
		
	},
	'Chinese Library':{
		'location':'12 Kent Ridge Crescent (S) 119275',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 2028',
		'fax':'+65 6777 3571',
		'stop': [['CENTRAL LIBRARY', 'IT']]
	},
	'Hon Sui Sen Memorial Library':{
		'location':'1 Hon Sui Sen Drive (S) 117588',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 3131',
		'fax':'+65 6778 6301',
		'stop': [['BIZ 2'], ['COM 2']]
	},
	'Medical Library':{
		'location':'Centre for Translational Medicine, Block MD6, 14 Medical Drive, #05-01 (S) 117599',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 2046',
		'fax':'+65 6773 6574',
		'stop': [['KR MRT'], ['OPP KR MRT']]
	},
	'Music Library':{
		'location':'3 Conservatory Drive (S) 117376',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 8130',
		'fax':'+65 6778 9849',
		'stop': [["MUSEUM", "RAFFLES HALL"]]
	},
	'Science Library':{
		'location':'10 Science Drive 2, Block S6 Level 4 (S) 117548',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 2454',
		'fax':'+65 6778 6118',
		'stop': [['S 17', 'LT 27']]
	},
	'NUS Museum':{
		'location':'University Cultural Centre, 50 Kent Ridge Crescent (S) 119279',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 8817',
		'fax':'+65 6778 3738',
		'stop': [["MUSEUM", "RAFFLES HALL"]]
	},
	'Student Service Centre':{
		'location':'31 Lower Kent Ridge Road, Yusof Ishak House Level 1 (S) 119078',
		'area':'Kent Ridge Campus',
		'tel':'+65 6516 1177',
		'fax':'+65 6777 0155',
		'stop': [['YIH', 'OPP YIH'], ['UHC', 'OPP UHC']]
	},
	'University Health Centre':{
		'location':'20 Lower Kent Ridge Road, University Health Centre (S) 119080',
		'area':'Kent Ridge Campus',
		'tel':'+65 6776 1631',
		'fax':'+65 6778 3173',
		'stop': [['UHC', 'OPP UHC'],['YIH', 'OPP YIH']]
	},
	'Eusoff Hall':{
		'location':'10 Kent Ridge Drive (S) 119242',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['LT 13', 'VENTUS', 'AS 5'], ['KR BUS TERMINAL']]
	},
	'Kent Ridge Hall':{
		'location':'10 Heng Mui Keng Terrace (S) 119617',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['BIZ 2'], ['COM 2']]
	},
	'King Edward VII Hall':{
		'location':'1A Kent Ridge Road (S) 119224',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['PGP RESIDENCES', 'PGP']]
	},
	'Prince George\'s Park Residences':{
		'location':'27 Prince George\'s Park Road (S) 118425',
		'area':'Kent Ridge Campus',
		'tel':'+65 6601 1111',
		'fax':'+65 6778 2050',
		'stop': [['PGP RESIDENCES', 'PGP']]
	},
	'Raffles Hall':{
		'location':'19 Kent Ridge Crescent (S) 119278',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [["MUSEUM", "RAFFLES HALL"]]
	},
	'Sheares Hall':{
		'location':'20 Heng Mui Keng Terrace (S) 119618',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [["MUSEUM", "RAFFLES HALL"]]
	},
	'Temasek Hall':{
		'location':'12 Kent Ridge Drive (S) 119243',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [["MUSEUM", "RAFFLES HALL"]]
	},
	'UTown Residence':{
		'location':'36 College Avenue East (S) 138600',
		'area':'Kent Ridge - UTOWN Campus',
		'tel':'',
		'fax':'',
		'stop': [['UNIVERSITY TOWN']]
	},

	'FoS': {
		'location': 'FoS',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['S 17', 'LT 27']]
	},

	'SoC': {
		'location': 'SoC',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['COM 2'], ['BIZ 2']]
	},
	
	'FASS': {
		'location': 'FASS',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['LT 13', 'VENTUS', 'KR BUS TERMINAL']]
	},

	'BIZ': {
		'location': 'BIZ',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['BIZ 2']]
	},
	
	'FoE': {
		'location': 'FoE',
		'area':'Kent Ridge Campus',
		'tel':'',
		'fax':'',
		'stop': [['EA', 'JAPANESE PRI SCH', 'YIH', 'OPP YIH']]
	},
}



buildings = []
for k in building_dic:
    building_dic[k]['name'] = k
	if k not in ['FoS', 'SoC', 'FASS', 'BIZ', 'FoE']:
		building_dic[k]['imageUrl'] = '/building/image/' + k.replace(' ', '+') + '.jpg'
		building_dic[k]['locationUrl'] = '/building/location/' + k.replace(' ', '+') + '.png'
    buildings.append(building_dic[k])



initial_sql = """USE `nustour_db`;
CREATE TABLE IF NOT EXISTS `building` (
--  name          type            constraints
    `id`          INT             NOT NULL      AUTO_INCREMENT,
    `name`        VARCHAR(32)     NOT NULL      UNIQUE,
    `location`    VARCHAR(256)    NOT NULL      ,
    `area`        VARCHAR(128)    NOT NULL      ,
    `tel`         VARCHAR(32)     NOT NULL      ,
    `fax`         VARCHAR(32)     NOT NULL      ,
    
    PRIMARY KEY (`id`)
);
""" 

def to_sql(d):
    return 'INSERT INTO `building` (`name`, `location`, `area`, `tel`, `fax`, `locationUrl`, `imageUrl`) VALUES ("{}", "{}", "{}", "{}", "{}", "{}", "{}");'.format(d['name'], d['location'], d['area'], d['tel'], d['fax'], d['locationUrl'], d['imageUrl'])

sqls = list(map(to_sql, buildings))

with open('buildings.sql', 'w') as f:
    f.write(initial_sql)
    f.write('\n'.join(sqls))
    



# Near bus stops
def to_near_bus_stop_sql(building_name, stop_name, priority):
	return 'INSERT INTO `near_bus_stop` (`building_id`, `stop_id`, `priority`) SELECT `building`.`id`, `stop`.`id`, {} FROM `stop`, `building` WHERE `stop`.`name` = "{}" AND `building`.`name` = "{}";'.format(priority, stop_name, building_name)

near_stops_sqls = []
for k in building_dic:
	for priority, stops in enumerate(building_dic[k]['stop']):
		for stop in stops:
			near_stops_sqls.append(
				to_near_bus_stop_sql(k, stop, priority)
			)

with open('near_bus_stops.sql', 'w') as f:
	f.write('USE `nustour_db`;\n\n')
	f.write('\n'.join(near_stops_sqls))
